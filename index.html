<html>

<head>
  <title>Face Detect Online</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js" integrity="sha512-2RDFHqfLZW8IhPRvQYmK9bTLfj/hddxGXQAred2wNZGkrKQkLGj8RCkXfRJPHlDerdHHIzTFaahq4s/P4V6Qig==" crossorigin="anonymous"></script>
</head>

<body>
  <h1>Face Detect Online</h1>
  <img src="http:192.168.1.177:5000/video_feed">
  <div id="stop">stop</div>
</body>

</html>
<script>
  var socket = io.connect("http://192.168.1.177:5000");
  var MediaUtils = {
    getUserMedia: function (videoEnable, audioEnable, callback) {
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || window.getUserMedia;
      var constraints = {
        video: videoEnable,
        audio: audioEnable
      };
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {
          callback(false, stream);
        })['catch'](function (err) {
          callback(err);
        });
      } else if (navigator.getUserMedia) {
        navigator.getUserMedia(constraints, function (stream) {
          callback(false, stream);
        }, function (err) {
          callback(err);
        });
      } else {
        callback(new Error('Not support userMedia'));
      }
    },
  }
  function requestMedia() {
    var chunks = []
    MediaUtils.getUserMedia(true, true, (err, stream) => {
      if (err) throw err
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start(0);
      mediaRecorder.onstop = (e) => stream.stop();
      document.getElementById('stop').addEventListener("click", () => mediaRecorder.stop())

      mediaRecorder.ondataavailable = (e) => {
        chunks.push(e.data);
        if (chunks.length >= 1000) {
          var mimeFile = new File([new Blob(chunks, { 'type': this.mediaRecorder.mimeType })], 'msr-' + (new Date).toISOString().replace(/:|\./g, '-') + '.mp4');
          socket.emit('stream', mimeFile);
          chunks = []
        }
      }
    })
  }
  requestMedia()
</script>